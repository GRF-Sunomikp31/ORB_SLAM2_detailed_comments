# ORB-SLAM2课程笔记

注释代码：https://github.com/GRF-Sunomikp31/ORB_SLAM2_detailed_comments

## ORB-SLAM2总结

ORB-SLAM2的特点：

- 共视图（只在能看到的）是的跟踪/建图控制在局部共视区域，与全局地图大小无关；
- 单目初始化和应用场景解耦（解耦就是没有关系）；
- 相比于直接法，可以用于宽baseline匹配；

不足：

- 相对于直接法（不提特征，比如**光流、梯度**），特征提取比较耗时，运行速度没有直接法高；
- 相比于直接法，在弱纹理、**重复纹理**、图像模糊的场景下容易跟踪丢失；

- 产生的地图比较稀疏；（直接法可以产生半稠密地图）

关于ORB-SLAM的地位：

- ORB-SLAM2在SLAM界地位无可动摇；

- 在VINS中，ORB-SLAM3也比VINS-Mono好

ORB-SLAM2主要模块:SIM3、EPNP、bow2、卡方检验、关键帧、BA、局部建图；

SLAM系统主要模块：VO、VIO、后端优化、回环检测；

## ORB-SLAM2课程介绍及论文详解

### **论文解读**

闭环的时候会做一个full BA；

Map（一直维护的）：地图点、关键帧、共视图、本征树；

#### **ORB-SLAM1：**

介绍：

- 宽基线的闭环baseline：检测的闭环的帧与最初的那一帧平移t比较大；即使平移比较大，也能检测到闭环；

- 自动初始化：和场景无关（平面和非平面，不需要明显的三维空间结构），

- 地图点和关键帧：跟踪的时候选择的比较多，但后有非常严格的筛选机制，local mapping剔除；

Related work：

- 回环检测（位置识别）：图像到图像、图像到map、map到图像，ORB（BRIEF）用的词袋；
- 地图初始化：ORB中用单应矩阵（平面）和本应矩阵（非平面）恢复深度；直到产生一个比较明显的视差才会初始化；
- 单目SLAM：用滤波的方法，比较浪费计算量，有些帧没有什么信息但是还要去算；关键帧的方法，BA更准确，建图和帧率无关，在同样的计算量下，关键帧的方法比滤波的方法更准确；
- loop colsing：七个自由度，R，T，和一个尺度 构成essential graph；（单目情况下是这样，双目和RGBD尺度是1）
- 其他work：LSD-SLAM，直接法，产生半稠密地图，但是需要特征做闭环，相机定位精度低；SVO，帧率高，没有闭环；

Methods：

- 特征选择：ORB：小尺度下，计算快，匹配快，视角不变；旋转不变性；光照鲁棒（像素的相对不会改变）；
- 三个线程：tracking计算相机pose，每一帧都要算是否作为关键帧插入，局部共视地图；local mapping：地图点、关键帧剔除；回环线程：SE（3），本质图；

词袋(词典)：vocabulary 用了100w张图，提取ORB特征点，最后构建了一个树状结构，离线训练的；优势：树状结构高效匹配；

自动初始化：平面和非平面，多组解的问题，把每个解都选择最优（实践）；

Local map：用共视关系求出来的；

局部BA：优化当前帧和共视关系的帧；

闭环检测：连续三次检测闭环，才确定成功；附近结构相似回环，而不是仅仅一帧；

SIM3:几何验证；

#### ORB-SLAM2

单目模式和1不一样的地方：

单目和RGBD/双目不同之处：双目模型下有一个远点和近点的判断；

- 远点：大于40；远点不准，远点比较多的时候插入关键帧，尽量引入更多近点；
- 近点：距离小于基线的40倍；（控制插入关键帧的频率）
- 双目和RGBD：一直初始化；不需要担心尺度问题；

### **通用结构**：

共视图：节点是关键帧，边是关键帧之间的共同观测地图点的数目（至少15个）；

![3](https://github.com/GRF-Sunomikp31/ORB_SLAM2_detailed_comments/blob/master/Notes/IMG/3.png)

共视图是为了：一级相邻和二级相邻优化一次位姿（增加更多关键帧之间信息去优化）；知识提供一种结构关系，可以用到很多地方优化；

本质图（Essential Graph）：

- 只针对关键帧，不考虑普通帧；
- 共视图比较稠密，本质图比共视图更稀疏；
- 包含：Spanning tree连接关系、形成闭环的连接关系（闭环关系）、共视关系比较好

扩展树（Spanning tree）：父节点和子节点，父关键帧和子关键帧；

## 代码

ORB-SLAM2中有很多类：

- map类：地图点
- keyframe类：存关键帧；
- frame类：存普通帧；

## 问题

相同纹理，闭环是否能成功检测？

网上有地图保存代码；ORB2和3本身没有这块代码；

可以看一下作者的博士论文，更加清楚；

C++：看红宝书，C++ primer；

RGBD可以实现稠密，高翔实现的那个；
