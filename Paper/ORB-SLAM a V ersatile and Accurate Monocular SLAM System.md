# ORB-SLAM: a V ersatile and Accurate Monocular SLAM System

## Introduction

从头开始设计一个新系统的所有任务：tracking, mapping, relocalization, and loop closing。

以前的SLAM算法并不能使用BA，要想使用，SLAM要为BA提供：

- 关键帧对场景特征（如地图点）的相应观察；
- 随着关键帧增加，系统的复杂度是增加的；系统选择应该避免不必要的冗余；
- 关键帧和点的连接，用来产生准确的结果；
- 为非线性优化的关键帧姿态和点位置的**初始估计**；
- 局部地图的优化可伸缩性；
- 能够快速完成全局优化（例如位姿图），来实时关闭循环；

本Paper的主要贡献：

- 所有任务使用相同的功能： tracking, mapping, relocalization and loop closing；这让系统更加高效、简单、可靠；使用ORB特性，可以在没有GPU的情况下实现性能，并且有良好的视角和光照不变性；
- 可以在大型环境中实时操作；使用了共视图，tracking and mapping 集中在局部共视区域，与全局地图大小无关；
- 基于位姿图优化的实时闭环（本质图）；
- 对视点和光照具有显著不变性的实时摄像机重新定位。这允许从跟踪失败中恢复，也增强了映射重用；
- 新的基于模型选择的自动初始化过程；允许创建平面和非平面场景的初试地图；
- 地图点和关键帧的选择，严格的筛选，提高了跟踪的健壮性（冗余关键帧被丢弃）；

直接优化像素强度，而不是特征重投影误差？

回环检测和重定位是之前的工作[11]；[12]给出了系统的初步版本；本文中增加了初始化方法、本质图；

（据我们所知）这是单目SLAM最完整、最可靠的解决方案；

## Related Work

**A.位置识别**：DBoW2首次使用了BRIEF描述符、FAST特征检测器获得二进制词袋，比SURF和SIFT特征相比，这减少了一个多数量级的特征提取时间。在作者之前的Paper[11]中，提出了一个基于DBoW2和ORB构建的位置识别词袋；ORB是一种对旋转和缩放(在一定范围内)具有不变性的二元特征，对视点具有很好的不变性；

**B.地图初始化**：单目SLAM需要初始化的原因是单张图片不能恢复深度；一种解决方法是首先跟踪一个已知的结构[20]；**这里ORB的地图初始化方法要留意**；

**C.单目SLAM**：

- PTAM：基于特征帧，跟踪和mapping线程拆分，Fast角点，只能跟踪，不能用于位置识别；不能回环检测；
- [34]的视觉里程表使用ORB特性进行跟踪和一个时间滑动窗口BA后端；但是没有其他部分；
- LSDSLAM：直接法(即直接对图像像素强度进行优化)，而不是对特征BA，构建半密集的地图，相机定位精度低；
- 介于直接法和特征法之间的方法：[22]，直接视觉测程SVO，无需在每一帧中提取特征，没有环路检测执行；

## Methods

### 系统概述

![1](C:\Users\lenovo\Desktop\ORB-SLAM2\ORB-SLAM2课程笔记\IMG\1.png)

A.特征选择：

- 系统设计思想之一：mapping和跟踪所使用的相同特征用于位置识别，以执行帧率重定位和循环检测；
- 特征提取实践远低于33ms每张图片；
- ORB:面向多尺度FAST角的256位描述符 ,  计算和匹配速度非常快，同时对视点具有良好的不变性;

B.三个线程Tracking, Local Mapping and Loop Closing：

- Tracking：定位图像，决定是否插入关键帧；首先执行与前一帧的初始特征匹配，并使用仅运动BA优化姿态；如果跟踪丢失(例如由于遮挡或突然运动)，位置识别模块将用于执行全局重定位；
- Local Mapping：局部BA，以实现对周围摄像头姿态的最优重建；负责剔除多余的关键帧
- Loop Closing：如果一个循环被检测到，我们计算一个相似变换来告知在循环中积累的漂移。然后对回路两边对齐，并融合重复点。最后对相似度约束[6]进行位姿图优化，实现全局一致性。

C.地图点、关键帧的选择：

- 地图点pi：点再世界坐标系的3D坐标；观察方向（是所有观察方向的平均单位向量）；ORB描述符；根据ORB特征的尺度不变性极限，得到点所能观测到的最大和最小距离。
- 关键帧ki：相机pose（点从世界坐标系到相机坐标系）；相机的参数（包括焦距和点）；在框架中提取的所有ORB特征(与地图点相关或不相关；**筛选机制负责检测冗余的关键帧和错误匹配或不可跟踪的地图点**。

D.共视图和因子图：

E.词袋：基于DBoW22[5]的词袋识别模块，进行循环检测和重定位。

### 地图自动初始化

地图初始化的目标是计算两帧之间的相对位姿，以三角剖分一组初始地图点。方法只在确定双视图配置安全时进行初始化，检测低视差情况和众所周知的双平面模糊度[27]，避免初始化损坏的地图。

流程：

- 发现初始对应关系：从当前帧提取ORB特征，并寻找匹配的特征点，如果匹配不足，则重置参考帧；
- 两种模型并行计算：单应性矩阵和基本矩阵；
- 模型选择：平面或者几何式平面用单应性矩阵；具有足够视差的非平面场景只能通过基本矩阵来解释
- 运动恢复中的运动和结构：
- BA:最后做一个full BA;

### Tracking

A. ORB提取：**

- 提取了8个尺度级别的FAST角，尺度因子为1.2；对于分辨率从512 × 384到752 × 480像素的图像，我们发现适合提取1000个角，对于更高的分辨率，如KITTI数据集中的1241 × 376，我们提取了2000个角。

- 为了保证均匀分布，划分网格，每一个网格中至少五个角；
- 后在每个单元中检测角点，如果没有找到足够的角点，自适应检测阈值。

**B.从前一帧的初始姿态估计：**如果最后一帧跟踪成功，我们使用匀速运动模型来预测摄像机姿态，并对最后一帧中观察到的地图点进行引导搜索

C.从全局重定位中初始化姿态：如果丢失跟踪，我们将帧转换为单词袋，并查询识别数据库的关键帧候选，以进行全局重定位；

D.跟踪当前地图：一旦有了相机姿态的估计和特征匹配的初始集合，我们可以将地图投影到帧中，并搜索更多的地图点对应。

E.新的关键帧的判断：条件如下：

- 上次全局重定位传递的帧数必须超过20帧。
- 本地mapping是空闲的，或者上次插入关键帧时传递了超过20帧。
- 当前帧跟踪至少50个点。
- 当前帧比Kref跟踪不到90%的点；

### Local Mapping

A.关键帧的插入：在共视图中插入节点；

B.最近地图点的剔除：地图点保留的条件：跟踪必须在超过25%的帧中找到它被预测为可见的点；果从mapping点创建开始有超过一个关键帧被传递，那么它必须至少从三个关键帧被观察到。

C.创建新地图点

D.local BA：局部BA优化当前处理的关键帧

E.Local Keyframe:减少BA的复杂程度；

### Loop Closing

循环关闭线程使用Ki(本地映射处理的最后一个关键帧)，并尝试检测和关闭循环。

A.闭环判断：计算ki的词袋向量与它在共可见图(θmin= 30)中所有邻域的相似度，并保留最小值smin。然后查询识别数据库，丢弃所有得分低于smin的关键帧；

B.计算相似变换：单目SLAM中有7个自由度，其中地图可以漂移，3个平移，3个旋转和一个比例因子；所以结束一个循环，需要计算一个相似变换。

C.回环融合：第一步是融合重复的地图点；

D.本质图优化：对本质图执行位姿图优化，该优化将沿图分布闭环错误；

## Experiments

数据集：NewCollege（大型机器人序列）、TUM RGB-D、KITTI dataset（户外汽车）；

### A.NewCollege Dataset

local BA是最花时间的，150ms-350ms；

### B.TUM RGB-D

定位精度：16个数据集上，ORB在12个效果比PTAM好，一个不能初始化（这是一个平面场景，由于相机相对于平面的轨迹有两种可能的解释，即在[27]中描述的双重模糊性。ORB初始化方法检测歧义，并为安全起见拒绝初始化）

重定位：ORB-SLAM比PTAM更精确地重新定位两帧

长距离定位：ORB地图是随着场景内容而增长的，而不是随着时间而增长的，这能够存储场景的动态变化

### C.KITTI Dataset

大规模的回环：ORB处理不了序列01，一条几乎没有可跟踪近距离物体的高速公路；轨迹误差通常在尺寸的1%左右；

## Conclusion

总结：

- 室内定位精度通常低于1cm，室外大场景定位精度几米？（在尺度和地面gt对齐之后）；
- 结合了很多过去几年优秀的方法，[5]的闭环判断、[6]的共视图和回环检测、[37]利用g2o优化的框架、[9]的ORB特性；
- 新策略是生成和筛选关键帧，允许每隔几帧就创建关键帧，当认为冗余时，这些关键帧最终会被删除。这种灵活的地图扩展在条件恶劣的探索轨迹中非常有用；
- 不需要GPU或者多线程；

稀疏/基于特征  对比 密集/直接方法:

- 直接法：摄像头是通过直接优化图像像素强度本地化；不需要特征提取，在低纹理下效果好；例如：DTAM 和 LSD-SLAM； 问题：计算要求高、会受到摄像头影响；
- 特征法：视点和光照变化具有良好的不变性。BA联合优化相机姿态和点的传感器测量；本实验证明，**特征法更准确**；

不足之处及未来工作：

- 在跟踪过程中加入无穷远处的点可以提高系统的精度;
- 将ORB的稀疏地图升级为更密集、更有用的重建；想法是在稀疏地图上建立一个稠密地图；
- 未来的单目应该**结合直接法和特征法**；
- 单目SLAM不适合 **强旋转、无纹理或无运动** 的情况

## 问题

1、这里要关心ORB-SLAM1初始化的尺度问题以及特征点数量问题；

2、线程只有local  mapping，没有全局mapping或者全局BA吗；

最后有的；local BA只对当前帧操作吗？